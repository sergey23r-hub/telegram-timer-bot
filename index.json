const express = require('express');
const bodyParser = require('body-parser');
const { Telegraf } = require('telegraf');
const app = express();

const BOT_TOKEN = '8126263029:AAGFJSjkGOxGh_EaK0oe2c8MWD1PmYd9yvU';
const bot = new Telegraf(BOT_TOKEN);
const port = process.env.PORT || 3000;

app.use(bodyParser.json());

app.post('/start-timer', async (req, res) => {
    const { minutes, initData } = req.body;

    const userData = new URLSearchParams(initData);
    const userId = JSON.parse(userData.get('user')).id;

    console.log(`Таймер на ${minutes} минут для пользователя ${userId}`);

    setTimeout(() => {
        bot.telegram.sendMessage(userId, '⏰ Ваш таймер истёк!');
    }, minutes * 60 * 1000);

    res.sendStatus(200);
});

app.listen(port, () => {
    console.log(`Сервер запущен на порту ${port}`);
});

bot.launch();